{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="form-inline pull-right">
				{% if (stores|length > 1) %}
				<select class="form-control" onChange="location='{{ href_dashboard }}&store_id='+$(this).val()">
				{% for store in stores %}
				{% if (store['store_id'] == store_id) %}
					<option value="{{ store['store_id'] }}" selected="selected">{{ store['name'] }}</option>
				{% else %}
					<option value="{{ store['store_id'] }}">{{ store['name'] }}</option>
				{% endif %}
				{% endfor %}
				</select>
				{% endif %}
				<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
			</div>
			<h1>{{ heading_title }} {{ version }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
				<li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="container-fluid">
		{% if error['warning'] %}
		<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error['warning'] }}
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
		{% endif %}
		{% if success %}
		<div class="alert alert-success"><i class="fa fa-exclamation-circle"></i> {{ success }}
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
		{% endif %}
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
			</div>
			<div class="panel-body">
				<ul class="nav nav-tabs">
					<li class="active">
						<a href="{{ href_dashboard }}"><span class="fa fa-dashboard"></span> {{ text_dashboard }}</a>
					</li>
					<li>
						<a href="{{ href_setting }}"><span class="fa fa-cog"></span> {{ text_settings }}</a>
					</li>
					<li>
						<a href="{{ href_field_setting }}"><span class="fa fa-cog"></span> {{ text_field_settings }}</a>
					</li>
					<li>
						<a href="{{ href_custom_page }}"><span class="fa fa-user"></span> {{ text_custom_pages }}</a>
					</li>
					<li>
						<a href="{{ href_export_import }}"><span class="fa fa-file-o"></span> {{ text_export_import }}</a>
					</li>
					<li>
						<a href="{{ href_instruction }}"><span class="fa fa-graduation-cap"></span> {{ text_instructions }}</a>
					</li>
				</ul>
				
				<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form" class="form-horizontal">
					<div class="col-sm-12">
						{% if control_extensions %}
						<div class="page-header">
							<h3>{{ text_seo_extensions }}</h3>
						</div>
						<div class="control-extensions">
							{% for control_extension in control_extensions %}
							{% if control_extension['installed'] %}
							<div class="control-extension installed text-center">
								<img src="{{ catalog }}image/{{ control_extension['image'] }}" title="{{ control_extension['name'] }}" alt="{{ control_extension['name'] }}" class="image"/>
								<h4 class="name">{{ control_extension['name'] }}</h4>
								<a href="{{ control_extension['href'] }}" target="_blank" class="btn btn-info">{{ button_view }}</a>
							</div>
							{% else %}
							<div class="control-extension text-center">
								<img src="{{ catalog }}image/{{ control_extension['image'] }}" title="{{ control_extension['name'] }}" alt="{{ control_extension['name'] }}" class="image"/>
								<h4 class="name">{{ control_extension['name'] }}</h4>
								<a action="{{ control_extension['install_href'] }}" class="button-install btn btn-success">{{ button_install }}</a>
							</div>
							{% endif %}
							{% endfor %}
							<br class="clear"/>
						</div>
						{% endif %}
						{% if quick_setup_total %}
						<div class="page-header">
							<h3>{{ text_quick_setup }}</h3>
						</div>
						<div class="control-elements">
							{% for control_element in control_elements %}
							{% if control_element['used'] == 0 %}
							<div class="control-element row">
								<div class="col-sm-1">
									<a action="{{ control_element['edit_href'] }}" confirm="{{ control_element['confirm'] }}" class="button-edit btn btn-success">{{ button_edit }}</a>
								</div>
								<div class="col-sm-11">
									<h4 class="name">{{ control_element['name'] }}</h4>
									<p class="description">{{ control_element['description'] }}</p>
									<p class="extension-name">{{ control_element['extension_name'] }}</p>
									<a href="{{ control_element['href'] }}" target="_blank" class="details">{{ text_details }}</a>
									<br class="clear"/>
								</div>
							</div>
							{% endif %}
							{% endfor %}
						</div>
						{% endif %}
						{% if activated_total %}
						<div class="page-header">
							<h3>{{ text_activated }}</h3>
						</div>
						<div class="control-elements">
							{% for control_element in control_elements %}
							{% if control_element['used'] == 1 %}
							<div class="control-element row">
								<div class="col-sm-1">
									<a action="{{ control_element['edit_href'] }}" confirm="{{ control_element['confirm'] }}" class="button-edit btn btn-info">{{ button_edit }}</a>
								</div>
								<div class="col-sm-11">
									<h4 class="name">{{ control_element['name'] }}</h4>
									<p class="description">{{ control_element['description'] }}</p>
									<p class="extension-name">{{ control_element['extension_name'] }}</p>
									<a href="{{ control_element['href'] }}" target="_blank" class="details">{{ text_details }}</a>
									<br class="clear"/>
								</div>
							</div>
							{% endif %}
							{% endfor %}
						</div>
						{% endif %}
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">

function refresh() {
	var url = 'index.php?route={{ route }}/dashboard&{{ url_token }}&store_id={{ store_id }}';
					
	$("#form").load(url + ' #form >');
}

function showAlert(json) {
	$('.alert, .text-danger').remove();
	$('.form-group').removeClass('has-error');
						
	if (json['error']) {
		if (json['error']['warning']) {
			$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
		}				
				
		for (i in json['error']) {
			var element = $('#input_' + i);
					
			if (element.parent().hasClass('input-group')) {
                $(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
			} else {
				$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
			}
		}				
				
		$('.text-danger').parents('.form-group').addClass('has-error');
	}
			
	if (json['success']) {
		$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + '  <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
	}
}

</script>
<script type="text/javascript">

$('body').on('click', '.button-install', function(){
	$.ajax({
		type: 'post',
		url: $(this).attr('action'),
		data: '',
		dataType: 'json',
		beforeSend: function() {
			$('#content').fadeTo('slow', 0.5);
		},
		complete: function() {
			$('#content').fadeTo('slow', 1);
		},
		success: function(json) {
			showAlert(json);
			
			if (json['success']) {
				refresh();
			}
		},
		error: function(xhr, ajaxOptions, thrownError) {
			console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
    });
});

$('body').on('click', '.button-edit', function(){
	var validate = false;
	
	if ($(this).attr('confirm')) {
		if (confirm($(this).attr('confirm'))) {
			validate = true;
		}
	} else {
		validate = true;
	}
	
	if (validate) {
		$.ajax({
			type: 'post',
			url: $(this).attr('action'),
			data: '',
			dataType: 'json',
			beforeSend: function() {
				$('#content').fadeTo('slow', 0.5);
			},
			complete: function() {
				$('#content').fadeTo('slow', 1);
			},
			success: function(json) {
				showAlert(json);
			
				if (json['success']) {
					refresh();
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
				console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
			}
		});
	}
});

</script>
{{ footer }}