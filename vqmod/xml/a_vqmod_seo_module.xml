<?xml version="1.0" encoding="UTF-8"?>
<modification>
    <id> SEO module by Dreamvention</id>
    <version>1.0.0</version>
    <vqmver required="true">2.5.0</vqmver>
    <author> Dreamvention </author>

	
    <file name="admin/model/catalog/product.php">
        <operation error="skip" >
            <search position="replace" ><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET product_id = '" . (int)$product_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', tag = '" . $this->db->escape($value['tag']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "'");]]></search>
            <add><![CDATA[			$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET product_id = '" . (int)$product_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', tag = '" . $this->db->escape($value['tag']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "', robots = '" . $this->db->escape($value['robots']) . "'
			, changefreq = '" . $this->db->escape($value['changefreq']) . "', priority = '" . $this->db->escape($value['priority']) . "', sitemap = '" . $this->db->escape($value['sitemap']) . "'");]]></add>
      </operation>
   <!--       <operation error="skip" >
            <search position="replace" ><![CDATA[ meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "'");]]></search>
            <add><![CDATA[			$this->db->query("INSERT INTO " . DB_PREFIX . "product_description SET product_id = '" . (int)$product_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', tag = '" . $this->db->escape($value['tag']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "', robots = '" . $this->db->escape($value['robots']) . "'
			, changefreq = '" . $this->db->escape($value['changefreq']) . "', priority = '" . $this->db->escape($value['priority']) . "', sitemap = '" . $this->db->escape($value['sitemap']) . "'");]]></add>
        </operation>-->
    </file>
        <file name="admin/model/catalog/category.php">
        <operation error="skip" >
            <search position="replace" ><![CDATA[$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET category_id = '" . (int)$category_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "'");]]></search>
            <add><![CDATA[			$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET category_id = '" . (int)$category_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "', robots = '" . $this->db->escape($value['robots']) . "'
			, changefreq = '" . $this->db->escape($value['changefreq']) . "', priority = '" . $this->db->escape($value['priority']) . "', sitemap = '" . $this->db->escape($value['sitemap']) . "'");]]></add>
        </operation>
<!--        <operation error="skip" >
            <search position="replace" ><![CDATA[ meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "'");]]></search>
            <add><![CDATA[			$this->db->query("INSERT INTO " . DB_PREFIX . "category_description SET category_id = '" . (int)category_id . "', language_id = '" . (int)$language_id . "', name = '" . $this->db->escape($value['name']) . "', description = '" . $this->db->escape($value['description']) . "', tag = '" . $this->db->escape($value['tag']) . "', meta_title = '" . $this->db->escape($value['meta_title']) . "', meta_description = '" . $this->db->escape($value['meta_description']) . "', meta_keyword = '" . $this->db->escape($value['meta_keyword']) . "', robots = '" . $this->db->escape($value['robots']) . "'
			, changefreq = '" . $this->db->escape($value['changefreq']) . "', priority = '" . $this->db->escape($value['priority']) . "', sitemap = '" . $this->db->escape($value['sitemap']) . "'");]]></add>
        </operation>-->
    </file>
    <file path="admin/controller/catalog/" name="product.php,category.php" >
        <operation error="skip" >
            <search position="before"  ><![CDATA[$data['tab_general'] = $this->language->get('tab_general');]]></search>
            <add><![CDATA[		$data['tab_general_seo'] = $this->language->get('tab_general_seo');
					$data['tab_data_seo'] = $this->language->get('tab_data_seo');
					$data['tags_robots'] = $this->language->get('tags_robots');
					$data['robots_tooltip'] = $this->language->get('robots_tooltip');
                                        $data['help_sitemap_changefreq'] = $this->language->get('help_sitemap_changefreq');
                                        $data['help_sitemap_priority'] = $this->language->get('help_sitemap_priority');
                                        $data['text_changefreq'] = $this->language->get('text_changefreq');
                                        $data['text_priority'] = $this->language->get('text_priority');
                                        $data['text_sitemap_show'] = $this->language->get('text_sitemap_show');
                                        $data['help_sitemap_show'] = $this->language->get('help_sitemap_show');
					$this->load->model('setting/setting');
					$data['snipet'] = $this->model_setting_setting->getSettingValue('d_seo' , 'd_seo_snipet'  );
					  ]]></add>
        </operation>
      </file>
    <file name="admin/controller/catalog/product.php">
        <operation error="skip" >
            <search position="after" offset="1"  ><![CDATA[$product_info = $this->model_catalog_product->getProduct($this->request->get['product_id']);]]></search>
			
            <add><![CDATA[		if   (!empty($product_info['robots'])) {
                                                $data['robots'] = $product_info['robots'];
                                        } else {
                                                $data['robots'] = 'index,follow';
                                        } ]]></add>
        </operation>
    </file>
    <file path="admin/language/english/catalog/" name="product.php,category.php">
        <operation error="skip" >
            <search position="before"  ><![CDATA[// Help]]></search>
			
            <add><![CDATA[		// SEO by Dreamvention
                                        $_['text_changefreq']			= 'Changefreq';
                                        $_['text_priority']			= 'Priority';
                                        $_['help_sitemap_changefreq']		= 'Changefreq  value.';
                                        $_['help_sitemap_priority']		= 'Priority  value.';
                                        $_['help_sitemap_show']                 = 'Should this page be in the XML Sitemap at all times, regardless of Robots Meta settings?';
                                        $_['text_sitemap_show']                 = 'Show in Sitemap:';
					$_['tab_general_seo']                   = 'General SEO';
					$_['tags_robots']                       = 'Meta tags robots';
					$_['tab_data_seo']                      = 'Data SEO';
					$_['robots_tooltip']                    = 'These meta tags can control the behavior of search engine crawling and indexing.';]]></add>
					
					  
        </operation>

    </file>
    <file name="admin/model/setting/setting.php">
        <operation error="skip" >
            <search position="before"  ><![CDATA[public function editSettingValue($code = '', $key = '', $value = '', $store_id = 0) {]]></search>
            <add><![CDATA[	public function getSettingValue($code , $key , $store_id = 0) {
		 
		
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "setting WHERE store_id = '" . (int)$store_id . "' AND `code` = '" . $this->db->escape($code) . "'AND `key` = '" . $this->db->escape($key) . "'");
		
		foreach ($query->rows as $result) {
			 
			if (!$result['serialized']) {
				$setting_data= $result['value'];
			} else {
				$setting_data = unserialize($result['value']);
			}
		}
		if(isset($setting_data )){
			return $setting_data;
		}else{
			return false;
		}
	}]]></add>
        </operation>
    </file>
    <file name="admin/view/template/catalog/product_form.tpl, ">
        <operation error="skip" >
            <search position="after"  offset="29" ><![CDATA[<textarea name="product_description[<?php echo $language['language_id']; ?>][description]" placeholder="<?php echo $entry_description; ?>" id="input-description<?php echo $language['language_id']; ?>"><?php echo isset($product_description[$language['language_id']]) ? $product_description[$language['language_id']]['description'] : ''; ?></textarea>]]></search>
            <add><![CDATA[					</div>					
								<div class="tab-pane" id="tab-data-seo-<?php echo $language['language_id']; ?>">  
									<div class="form-group">
										<label class="col-sm-2 control-label">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $robots_tooltip; ?>"><?php echo $tags_robots; ?></span>
										</label>
										<div class="col-sm-10">
											<div class="">
											 
												<label for="noindex-nofollow-<?php echo $language['language_id']; ?>" class="radio-inline">
													<input type="radio" value="noindex,nofollow" <?php if(isset($product_description[$language['language_id']]['robots']) && $product_description[$language['language_id']]['robots'] == "noindex,nofollow"){ echo 'checked="checked"'; } ?> name="product_description[<?php echo $language['language_id']; ?>][robots]"  id="noindex-nofollow-<?php echo $language['language_id']; ?>">
													noindex,nofollow               
												</label>
												<label for="noindex-follow-<?php echo $language['language_id']; ?>" class="radio-inline">
													<input type="radio" value="noindex,follow" <?php if(isset($product_description[$language['language_id']]['robots']) && $product_description[$language['language_id']]['robots'] == "noindex,follow"){ echo 'checked="checked"'; } ?> name="product_description[<?php echo $language['language_id']; ?>][robots]" id="noindex-follow-<?php echo $language['language_id']; ?>">
													noindex,follow                  
												</label>
												<label for="index-follow-<?php echo $language['language_id']; ?>" class="radio-inline">
													<input type="radio" value="index,follow" <?php if((isset($product_description[$language['language_id']]['robots']) && $product_description[$language['language_id']]['robots'] == "index,follow") || (!isset($product_description[$language['language_id']]['robots']) || empty($product_description[$language['language_id']]['robots']))){ echo 'checked="checked"'; } ?> name="product_description[<?php echo $language['language_id']; ?>][robots]" id="index-follow-<?php echo $language['language_id']; ?>">
													index,follow                  
												</label>
											</div>
									    </div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $help_sitemap_changefreq; ?>"><?php echo $text_changefreq; ?></span>
										</label>
										<div class="col-sm-10">
											<div class="">
												 <select name="product_description[<?php echo $language['language_id']; ?>][changefreq]" class="form-control">
													<?php if( empty($product_description[$language['language_id']]['changefreq'])) {?>
															<option value="" selected="selected" > </option>
													<?php } else { ?>
															<option value="" > </option>
													<?php }   ?>
                                                                                                        <?php if($product_description[$language['language_id']]['changefreq'] == "always") {?>
															<option value="always" selected="selected" >always</option>
													<?php } else { ?>
															<option value="always" >always</option>
													<?php }   ?>
													<?php if($product_description[$language['language_id']]['changefreq'] == "hourly") {?>
														<option value="hourly" selected="selected">hourly</option>
													<?php } else { ?>
														<option value="hourly" >hourly</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['changefreq'] == "daily"){ ?>
														<option value="daily" selected="selected" >daily</option>
													<?php } else { ?>
														<option value="daily"  >daily</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['changefreq'] == "weekly") { ?>
														<option value="weekly" selected="selected">weekly</option>
													<?php } else { ?>
														<option value="weekly" >weekly</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['changefreq'] == "monthly") { ?>
														<option value="monthly" selected="selected" >monthly</option>
													<?php } else { ?>
														<option value="monthly" >monthly</option>
													<?php } ?>
`													<?php if($product_description[$language['language_id']]['changefreq'] == "yearly") { ?>
														<option value="yearly" selected="selected">yearly</option>
													<?php } else { ?>
														<option value="yearly" >yearly</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['changefreq'] == "never") {?>
														<option value="never" selected="selected" >never</option>
													<?php } else { ?>
														<option value="never" >never</option>
													<?php } ?>
												 </select>
											</div>
									    </div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $help_sitemap_priority; ?>"><?php echo $text_priority; ?></span>
										</label>
										<div class="col-sm-10">
											<div class="">
												 <select name="product_description[<?php echo $language['language_id']; ?>][priority]" class="form-control">
													<?php if(  empty($product_description[$language['language_id']]['priority']) ) {?>
														<option value="" selected="selected" >   </option>
													<?php } else { ?>
														<option value=""  >    </option>
													<?php } ?>
                                                                                                        <?php if($product_description[$language['language_id']]['priority'] == 1.0 ) {?>
														<option value="1.0" selected="selected" >1.0</option>
													<?php } else { ?>
														<option value="1.0"  >1.0</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['priority'] == 0.75) {?>
														<option value="0.75" selected="selected" >0.75</option>
													<?php } else { ?>
														<option value="0.75" >0.75</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['priority'] == 0.5) {?>
														<option value="0.5" selected="selected" >0.5</option>
													<?php } else { ?>
														<option value="0.5" >0.5</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['priority'] == 0.25) {?>
														<option value="0.25" selected="selected" >0.25</option>
													<?php } else { ?>
														<option value="0.25" >0.25</option>
													<?php } ?>
													<?php if($product_description[$language['language_id']]['priority'] == 0.1 ) {?>
														<option value="0.1" selected="selected" >0.1</option>
													<?php } else { ?>
														<option value="0.1" >0.1</option>
													<?php } ?>
                                                                                                        <?php if($product_description[$language['language_id']]['priority'] == 0.0 && !empty($product_description[$language['language_id']]['priority'])) {?>
														<option value="0.0" selected="selected" >0.0</option>
													<?php } else { ?>
														<option value="0.0" >0.0</option>
													<?php } ?>
												 </select>
											</div>
									    </div>
									</div>
									
									<div class="form-group">
										<label class="col-sm-2 control-label" for="input-catalog-limit">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $help_sitemap_show; ?>">
													<?php echo $text_sitemap_show; ?>          
											</span>
										</label>
										<div class="col-sm-10">
											<div class="checkbox">
												<label>
														<input type="hidden" value="0" name="product_description[<?php echo $language['language_id']; ?>][sitemap]" >
													<?php if ( $product_description[$language['language_id']]['sitemap'] == 0) { ?>
														<input type="checkbox" value="1" name="product_description[<?php echo $language['language_id']; ?>][sitemap]"><?php echo $text_enabled; ?>
													<?php  } else  { ?>
														<input type="checkbox" value="1" name="product_description[<?php echo $language['language_id']; ?>][sitemap]"  checked="checked" ><?php echo $text_enabled; ?>
													<?php } ?>
												</label>
											</div>
										</div>
									</div>
			          
			            
			     
							</div>
							
						</div>
						</div>]]></add>
        </operation>
        <operation error="skip" >
            <search position="after"  offset="2" ><![CDATA[<textarea name="product_description[<?php echo $language['language_id']; ?>][description]" placeholder="<?php echo $entry_description; ?>" id="input-description<?php echo $language['language_id']; ?>"><?php echo isset($product_description[$language['language_id']]) ? $product_description[$language['language_id']]['description'] : ''; ?></textarea>]]></search>
            <add><![CDATA[								<div class="col-sm-offset-2 col-sm-10">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#tab-general-seo-<?php echo $language['language_id']; ?>" data-toggle="tab"><?php echo $tab_general_seo; ?> </a></li>
							<li><a href="#tab-data-seo-<?php echo $language['language_id']; ?>" data-toggle="tab"><?php echo $tab_data_seo; ?></a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="tab-general-seo-<?php echo $language['language_id']; ?>">  
								<div class="form-group ">
									<label class="col-sm-2 control-label" for="wpseosnippet-<?php echo $language['language_id']; ?>">Snippet Preview</label>
									<div class="col-sm-10">
									 
										  <div id="wpseosnippet-<?php echo $language['language_id']; ?>">																															
											<a class="title" id="wpseosnippet_title-<?php echo $language['language_id']; ?>"  ><span class = "snipet-body"><?php echo (isset($product_description[$language['language_id']]['meta_title']) && !empty($product_description[$language['language_id']]['meta_title'])) ? $product_description[$language['language_id']]['meta_title'] : $entry_meta_title; ?></span></a>
											<span class="url"><?php  echo $_SERVER['HTTP_HOST']; ?></span>
											<p class="desc"><span class="autogen"></span><span class="content"><?php echo (isset($product_description[$language['language_id']]['meta_title']) && !empty($product_description[$language['language_id']]['meta_title'])) ? $product_description[$language['language_id']]['meta_description'] : 'Here You can see your meta description.  
											Which include 160 symbols from product or page description or 
											custom text which You insert in field "meta description"!' ?></span></p>
										</div>
									</div>
									<script> 
                                                                                    $(document).ready(function(){
                                                                                                
												$('#input-meta-title<?php echo $language['language_id']; ?>').on("keyup", function(){
													title = $(this).val();
													if((title.length  >  70 ) && !$('#input-meta-title<?php echo $language['language_id']; ?> + .alert-danger').length){
														$(this).after('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> Warning: Please check the form carefully for errors!      <button type="button" class="close" data-dismiss="alert">×</button></div>');
														 
													}
													 if((title.length  < 70  ) && $('#input-meta-title<?php echo $language['language_id']; ?> + .alert-danger').length){
														$('#input-meta-title<?php echo $language['language_id']; ?> + .alert-danger').remove();
														 
												 	}
													
													$("#wpseosnippet_title-<?php echo $language['language_id']; ?> span.snipet-body").text($(this).val());
												})
                                                                                                $('#input-meta-title<?php echo $language['language_id']; ?>').on("click",
                                                                                                    function() {
                                                                                                     var $self = $(this);
                                                                                                     if($self.val().length == 0){
                                                                                                      $self.val('<?php echo isset($snipet[$language['language_id']]['separator']) ? $snipet[$language['language_id']]['separator'] :''; ?>');
                                                                                                      $self.get(0).setSelectionRange(0,0);
                                                                                                     }
                                                                                                    })

												$('#input-name<?php echo $language['language_id']; ?>').on("focusout", function(){
													if($('#input-meta-title<?php echo $language['language_id']; ?>').val() == ''){
														$('#input-meta-title<?php echo $language['language_id']; ?>').val($(this).val()+ " <?php echo isset($snipet[$language['language_id']]['separator']) ? $snipet[$language['language_id']]['separator'] :''; ?>");
														$("#wpseosnippet_title-<?php echo $language['language_id']; ?> span.snipet-body").text($(this).val() + " <?php echo isset($snipet[$language['language_id']]['separator']) ? $snipet[$language['language_id']]['separator'] :''; ?>" );
													}
												})
												$('#input-meta-description<?php echo $language['language_id']; ?>').on("keyup", function(){
														descript = $(this).val();
													if((descript.length  > 180 ) && !$('#input-meta-description<?php echo $language['language_id']; ?> + .alert-danger').length){
														$(this).after('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> Warning: Please check the form carefully for errors!      <button type="button" class="close" data-dismiss="alert">×</button></div>');
														 
													}
													if((descript.length  < 180 ) && $('#input-meta-description<?php echo $language['language_id']; ?> + .alert-danger').length){
														$('#input-meta-description<?php echo $language['language_id']; ?> + .alert-danger').remove();
														 
													}
													$("#wpseosnippet-<?php echo $language['language_id']; ?> .content").text($(this).val());
												})
												$('[name="product_description[<?php echo $language['language_id']; ?>][description]"]').next('.note-editor').find('.note-editable').on("focusout", function(){
												
													if($('#input-meta-description<?php echo $language['language_id']; ?>').val() == ''){
														$('#input-meta-description<?php echo $language['language_id']; ?>').val($(this).text().replace(/\s+/g, ' ').substr(0,180));
														$("#wpseosnippet-<?php echo $language['language_id']; ?> .content").text($(this).text().replace(/\s+/g, ' ').substr(0,180));
													}
												})
										})
									</script>
									<style>
										#wpseosnippet-<?php echo $language['language_id']; ?> {
										  width: auto;
										  max-width: 520px;
										  margin: 0 0 10px;
										  padding: 0 5px;
										  font-family: Arial,Helvetica,sans-serif;
										  font-style: normal;
										}
										#wpseosnippet-<?php echo $language['language_id']; ?> .title {
										  display: block;
										  overflow: hidden;
										  width: 512px;
										  color: #1e0fbe;
										  font-size: 18px!important;
										  line-height: 1.2;
										  white-space: nowrap;
										  text-overflow: ellipsis;
										}
										#wpseosnippet-<?php echo $language['language_id']; ?> .url {
										  color: #006621;
										  font-size: 13px;
										  line-height: 16px;
										}
										#wpseosnippet-<?php echo $language['language_id']; ?> .desc {
										  font-size: small;
										  line-height: 1.4;
										  word-wrap: break-word;
										}
									</style>
								</div>]]></add>
        </operation>
    </file>
      <file name="admin/view/template/catalog/category_form.tpl, ">
        <operation error="skip" >
            <search position="after"  offset="23" ><![CDATA[ <textarea name="category_description[<?php echo $language['language_id']; ?>][description]" placeholder="<?php echo $entry_description; ?>" id="input-description<?php echo $language['language_id']; ?>" class="form-control"><?php echo isset($category_description[$language['language_id']]) ? $category_description[$language['language_id']]['description'] : ''; ?></textarea>]]></search>
            <add><![CDATA[					</div>					
								<div class="tab-pane" id="tab-data-seo-<?php echo $language['language_id']; ?>">  
									<div class="form-group">
										<label class="col-sm-2 control-label">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $robots_tooltip; ?>"><?php echo $tags_robots; ?></span>
										</label>
										<div class="col-sm-10">
											<div class="">
											 
												<label for="noindex-nofollow-<?php echo $language['language_id']; ?>" class="radio-inline">
													<input type="radio" value="noindex,nofollow" <?php if(isset($category_description[$language['language_id']]['robots']) && $category_description[$language['language_id']]['robots'] == "noindex,nofollow"){ echo 'checked="checked"'; } ?> name="category_description[<?php echo $language['language_id']; ?>][robots]"  id="noindex-nofollow-<?php echo $language['language_id']; ?>">
													noindex,nofollow               
												</label>
												<label for="noindex-follow-<?php echo $language['language_id']; ?>" class="radio-inline">
													<input type="radio" value="noindex,follow" <?php if(isset($category_description[$language['language_id']]['robots']) && $category_description[$language['language_id']]['robots'] == "noindex,follow"){ echo 'checked="checked"'; } ?> name="category_description[<?php echo $language['language_id']; ?>][robots]" id="noindex-follow-<?php echo $language['language_id']; ?>">
													noindex,follow                  
												</label>
												<label for="index-follow-<?php echo $language['language_id']; ?>" class="radio-inline">
													<input type="radio" value="index,follow" <?php if((isset($category_description[$language['language_id']]['robots']) && $category_description[$language['language_id']]['robots'] == "index,follow") || (!isset($category_description[$language['language_id']]['robots']) || empty($category_description[$language['language_id']]['robots']))){ echo 'checked="checked"'; } ?> name="category_description[<?php echo $language['language_id']; ?>][robots]" id="index-follow-<?php echo $language['language_id']; ?>">
													index,follow                  
												</label>
											</div>
									    </div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $help_sitemap_changefreq; ?>"><?php echo $text_changefreq; ?></span>
										</label>
										<div class="col-sm-10">
											<div class="">
												 <select name="category_description[<?php echo $language['language_id']; ?>][changefreq]" class="form-control">
													<?php if(  empty($category_description[$language['language_id']]['changefreq']) ) {?>
														<option value="" selected="selected" >   </option>
													<?php } else { ?>
														<option value=""  >    </option>
													<?php } ?>
                                                                                                        <?php if($category_description[$language['language_id']]['changefreq'] == "always") {?>
															<option value="always" selected="selected" >always</option>
													<?php } else { ?>
															<option value="always" >always</option>
													<?php }   ?>
													<?php if($category_description[$language['language_id']]['changefreq'] == "hourly") {?>
														<option value="hourly" selected="selected">hourly</option>
													<?php } else { ?>
														<option value="hourly" >hourly</option>
													<?php } ?>
													<?php if(($category_description[$language['language_id']]['changefreq'] == "daily")  ){ ?>
														<option value="daily" selected="selected" >daily</option>
													<?php } else { ?>
														<option value="daily"  >daily</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['changefreq'] == "weekly") { ?>
														<option value="weekly" selected="selected">weekly</option>
													<?php } else { ?>
														<option value="weekly" >weekly</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['changefreq'] == "monthly") { ?>
														<option value="monthly" selected="selected" >monthly</option>
													<?php } else { ?>
														<option value="monthly" >monthly</option>
													<?php } ?>
`													<?php if($category_description[$language['language_id']]['changefreq'] == "yearly") { ?>
														<option value="yearly" selected="selected">yearly</option>
													<?php } else { ?>
														<option value="yearly" >yearly</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['changefreq'] == "never") {?>
														<option value="never" selected="selected" >never</option>
													<?php } else { ?>
														<option value="never" >never</option>
													<?php } ?>
												 </select>
											</div>
									    </div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $help_sitemap_priority; ?>"><?php echo $text_priority; ?></span>
										</label>
										<div class="col-sm-10">
											<div class="">
												 <select name="category_description[<?php echo $language['language_id']; ?>][priority]" class="form-control">
                                                                                                        <?php if(  empty($category_description[$language['language_id']]['priority']) ) {?>
														<option value="" selected="selected" >   </option>
													<?php } else { ?>
														<option value=""  >    </option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['priority'] == 1.0) {?>
														<option value="1.0" selected="selected" >1.0</option>
													<?php } else { ?>
														<option value="1.0"  >1.0</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['priority'] == 0.75) {?>
														<option value="0.75" selected="selected" >0.75</option>
													<?php } else { ?>
														<option value="0.75" >0.75</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['priority'] == 0.5) {?>
														<option value="0.5" selected="selected" >0.5</option>
													<?php } else { ?>
														<option value="0.5" >0.5</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['priority'] == 0.25) {?>
														<option value="0.25" selected="selected" >0.25</option>
													<?php } else { ?>
														<option value="0.25" >0.25</option>
													<?php } ?>
													<?php if($category_description[$language['language_id']]['priority'] == 0.1 ) {?>
														<option value="0.1" selected="selected" >0.1</option>
													<?php } else { ?>
														<option value="0.1" >0.1</option>
													<?php } ?>
                                                                                                        <?php if($category_description[$language['language_id']]['priority'] == 0.0 && !empty($category_description[$language['language_id']]['priority'])) {?>
														<option value="0.0" selected="selected" >0.0</option>
													<?php } else { ?>
														<option value="0.0" >0.0</option>
													<?php } ?>
												 </select>
											</div>
									    </div>
									</div>
									
									<div class="form-group">
										<label class="col-sm-2 control-label" for="input-catalog-limit">
											<span data-toggle="tooltip" title="" data-original-title="<?php echo $help_sitemap_show; ?> ">
													<?php echo $text_sitemap_show; ?>       
											</span>
										</label>
										<div class="col-sm-10">
											<div class="checkbox">
												<label>
														<input type="hidden" value="0" name="category_description[<?php echo $language['language_id']; ?>][sitemap]" >
													<?php if ( !empty($category_description[$language['language_id']]['sitemap']) && $category_description[$language['language_id']]['sitemap'] == 0) { ?>
														<input type="checkbox" value="1" name="category_description[<?php echo $language['language_id']; ?>][sitemap]"><?php echo $text_enabled; ?>
													<?php  } else  { ?>
														<input type="checkbox" value="1" name="category_description[<?php echo $language['language_id']; ?>][sitemap]"  checked="checked" ><?php echo $text_enabled; ?>
													<?php } ?>
												</label>
											</div>
										</div>
									</div>
			          
			            
			     
							</div>
							
						</div>
						</div>]]></add>
        </operation>
        <operation error="skip" >
            <search position="after"  offset="2" ><![CDATA[ <textarea name="category_description[<?php echo $language['language_id']; ?>][description]" placeholder="<?php echo $entry_description; ?>" id="input-description<?php echo $language['language_id']; ?>" class="form-control"><?php echo isset($category_description[$language['language_id']]) ? $category_description[$language['language_id']]['description'] : ''; ?></textarea>]]></search>
            <add><![CDATA[								<div class="col-sm-offset-2 col-sm-10">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#tab-general-seo-<?php echo $language['language_id']; ?>" data-toggle="tab"><?php echo $tab_general_seo; ?> </a></li>
							<li><a href="#tab-data-seo-<?php echo $language['language_id']; ?>" data-toggle="tab"><?php echo $tab_data_seo; ?></a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="tab-general-seo-<?php echo $language['language_id']; ?>">  
								<div class="form-group ">
									<label class="col-sm-2 control-label" for="wpseosnippet-<?php echo $language['language_id']; ?>">Snippet Preview</label>
									<div class="col-sm-10">
									 
										  <div id="wpseosnippet-<?php echo $language['language_id']; ?>">																															
											<a class="title" id="wpseosnippet_title-<?php echo $language['language_id']; ?>"  ><span class = "snipet-body"><?php echo (isset($category_description[$language['language_id']]['meta_title']) && !empty($category_description[$language['language_id']]['meta_title'])) ? $category_description[$language['language_id']]['meta_title'] : $entry_meta_title; ?></span></a>
											<span class="url"><?php  echo $_SERVER['HTTP_HOST']; ?></span>
											<p class="desc"><span class="autogen"></span><span class="content"><?php echo (isset($category_description[$language['language_id']]['meta_title']) && !empty($category_description[$language['language_id']]['meta_title'])) ? $category_description[$language['language_id']]['meta_description'] : 'Here You can see your meta description.  
											Which include 160 symbols from product or page description or 
											custom text which You insert in field "meta description"!' ?></span></p>
										</div>
									</div>
									<script> 
                                                                                    $(document).ready(function(){
                                                                                                
												$('#input-meta-title<?php echo $language['language_id']; ?>').on("keyup", function(){
													title = $(this).val();
													if((title.length  >  70 ) && !$('#input-meta-title<?php echo $language['language_id']; ?> + .alert-danger').length){
														$(this).after('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> Warning: Please check the form carefully for errors!      <button type="button" class="close" data-dismiss="alert">×</button></div>');
														 
													}
													 if((title.length  < 70  ) && $('#input-meta-title<?php echo $language['language_id']; ?> + .alert-danger').length){
														$('#input-meta-title<?php echo $language['language_id']; ?> + .alert-danger').remove();
														 
												 	}
													
													$("#wpseosnippet_title-<?php echo $language['language_id']; ?> span.snipet-body").text($(this).val());
												})
                                                                                                $('#input-meta-title<?php echo $language['language_id']; ?>').on("click",
                                                                                                    function() {
                                                                                                     var $self = $(this);
                                                                                                     if($self.val().length == 0){
                                                                                                      $self.val('<?php echo isset($snipet[$language['language_id']]['separator']) ? $snipet[$language['language_id']]['separator'] :''; ?>');
                                                                                                      $self.get(0).setSelectionRange(0,0);
                                                                                                     }
                                                                                                    })

												$('#input-name<?php echo $language['language_id']; ?>').on("focusout", function(){
													if($('#input-meta-title<?php echo $language['language_id']; ?>').val() == ''){
														$('#input-meta-title<?php echo $language['language_id']; ?>').val($(this).val()+ " <?php echo isset($snipet[$language['language_id']]['separator']) ? $snipet[$language['language_id']]['separator'] :''; ?>");
														$("#wpseosnippet_title-<?php echo $language['language_id']; ?> span.snipet-body").text($(this).val() + " <?php echo isset($snipet[$language['language_id']]['separator']) ? $snipet[$language['language_id']]['separator'] :''; ?>" );
													}
												})
												$('#input-meta-description<?php echo $language['language_id']; ?>').on("keyup", function(){
														descript = $(this).val();
													if((descript.length  > 180 ) && !$('#input-meta-description<?php echo $language['language_id']; ?> + .alert-danger').length){
														$(this).after('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> Warning: Please check the form carefully for errors!      <button type="button" class="close" data-dismiss="alert">×</button></div>');
														 
													}
													if((descript.length  < 180 ) && $('#input-meta-description<?php echo $language['language_id']; ?> + .alert-danger').length){
														$('#input-meta-description<?php echo $language['language_id']; ?> + .alert-danger').remove();
														 
													}
													$("#wpseosnippet-<?php echo $language['language_id']; ?> .content").text($(this).val());
												})
												$('[name="category_description[<?php echo $language['language_id']; ?>][description]"]').next('.note-editor').find('.note-editable').on("focusout", function(){
												
													if($('#input-meta-description<?php echo $language['language_id']; ?>').val() == ''){
														$('#input-meta-description<?php echo $language['language_id']; ?>').val($(this).text().replace(/\s+/g, ' ').substr(0,180));
														$("#wpseosnippet-<?php echo $language['language_id']; ?> .content").text($(this).text().replace(/\s+/g, ' ').substr(0,180));
													}
												})
										})
									</script>
									<style>
										#wpseosnippet-<?php echo $language['language_id']; ?> {
										  width: auto;
										  max-width: 520px;
										  margin: 0 0 10px;
										  padding: 0 5px;
										  font-family: Arial,Helvetica,sans-serif;
										  font-style: normal;
										}
										#wpseosnippet-<?php echo $language['language_id']; ?> .title {
										  display: block;
										  overflow: hidden;
										  width: 512px;
										  color: #1e0fbe;
										  font-size: 18px!important;
										  line-height: 1.2;
										  white-space: nowrap;
										  text-overflow: ellipsis;
										}
										#wpseosnippet-<?php echo $language['language_id']; ?> .url {
										  color: #006621;
										  font-size: 13px;
										  line-height: 16px;
										}
										#wpseosnippet-<?php echo $language['language_id']; ?> .desc {
										  font-size: small;
										  line-height: 1.4;
										  word-wrap: break-word;
										}
									</style>
								</div>]]></add>
        </operation>
    </file>
    <file name="system/library/document.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA[private $keywords;]]></search>
            <add><![CDATA[	private $robots;]]></add>
        </operation>
        <operation error="skip" >
            <search position="after"  offset="1" ><![CDATA[return $this->keywords;]]></search>
            <add><![CDATA[
	public function setRobots($robots) {
		$this->robots = $robots;
	}

	public function getRobots() {
		return $this->robots;
	}]]></add>
        </operation>
    </file>
    <file name="catalog/model/catalog/product.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA['meta_keyword'     => $query->row['meta_keyword'],]]></search>
            <add><![CDATA[				'robots'    	 => (isset($query->row['robots'])) ? $query->row['robots']  : "",
										'changefreq'    	 => (isset($query->row['changefreq'])) ? $query->row['changefreq']  : "",
										'priority'    	 => (isset($query->row['priority'])) ? $query->row['priority']  : "",
										'sitemap'    	 => (isset($query->row['sitemap'])) ? $query->row['sitemap']  : "",]]></add>
        </operation>
    </file>
      <file name="admin/model/catalog/category.php">
        <operation error="skip" >
            <search position="replase"  ><![CDATA['description'      => $result['description']]]></search>
            <add><![CDATA[                          'description'      => $result['description'],	
                                                    'robots'    	 => $result['robots'] ,
										'changefreq'    	 => $result['changefreq'] ,
										'priority'    	 => $result['priority'] ,
										'sitemap'    	 => $result['sitemap'] ,]]></add>
        </operation>
    </file> 
     <file name="admin/model/catalog/product.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA['meta_keyword'     => $result['meta_keyword'],]]></search>
            <add><![CDATA[                           	
                                                'robots'    	 => $result['robots'] ,
						'changefreq'    	 => $result['changefreq'] ,
						'priority'    	 => $result['priority'] ,
						'sitemap'    	 => $result['sitemap'] ,]]></add>
        </operation>
    </file>      
  <file name="catalog/controller/product/category.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA[$this->document->setKeywords($category_info['meta_keyword']);]]></search>
             <add><![CDATA[	$this->document->setRobots(isset($category_info['robots']) ? $category_info['robots'] : "index,follow") ;]]></add>
        </operation>
    </file>
    <file name="catalog/controller/product/product.php">
        <operation error="skip" >
            <search position="replace"  ><![CDATA[$this->document->addLink($this->url->link('product/product', 'product_id=' . $this->request->get['product_id']), 'canonical');]]></search>
            <add><![CDATA[			$this->document->setRobots($product_info['robots']); 
                $this->document->addLink($this->url->link('product/product',  $url . '&product_id=' . $this->request->get['product_id']), 'canonical');]]></add>
        </operation>
    </file>
    <file name="catalog/controller/common/header.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA[$data['keywords'] = $this->document->getKeywords();]]></search>
            <add><![CDATA[$data['robots'] = $this->document->getRobots();]]></add>
        </operation>
    </file>
    <file name="catalog/view/theme/*/template/common/header.tpl">
        <operation error="skip" >
            <search position="before"  ><![CDATA[</head>]]></search>
            <add><![CDATA[<?php if ($robots) { ?>
	<meta name="robots" content="<?php echo $robots; ?>" />
<?php }else{ ?> 
	<meta name="robots" content="index,follow" 
<?php } ?>]]></add>
        </operation>
    </file>
    <file name="catalog/model/setting/setting.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA[class ModelSettingSetting extends Model {]]></search>
            <add><![CDATA[	public function getSettingValue($code , $key , $store_id = 0) {
		 
		
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "setting WHERE store_id = '" . (int)$store_id . "' AND `code` = '" . $this->db->escape($code) . "'AND `key` = '" . $this->db->escape($key) . "'");
		
		foreach ($query->rows as $result) {
			 
			if (!$result['serialized']) {
				$setting_data= $result['value'];
			} else {
				$setting_data = unserialize($result['value']);
			}
		}
		if(isset($setting_data )){
			return $setting_data;
		}else{
			return false;
		}
	}]]></add>
        </operation>
    </file>
	<file name="catalog/controller/feed/google_sitemap.php">
        <operation error="skip" >
            <search position="after"  ><![CDATA[$this->load->model('tool/image');]]></search>
            <add><![CDATA[	 		$this->load->model('setting/setting');
			$store_id = $this->config->get('config_store_id');
			$setting = $this->model_setting_setting->getSettingValue('d_seo','d_seo_sitemap', $store_id );
			]]></add>
        </operation>
		<operation error="skip" >
            <search position="replace"  ><![CDATA[if ($product['image']) {]]></search>
            <add><![CDATA[	 		 
				if ($product['image'] && $product['sitemap']) {
			]]></add>
        </operation>
		 <operation error="skip" >
            <search position="after"  ><![CDATA[$results = $this->model_catalog_category->getCategories($parent_id);]]></search>
            <add><![CDATA[	
			$store_id = $this->config->get('config_store_id');
			$setting = $this->model_setting_setting->getSettingValue('d_seo','d_seo_sitemap', $store_id );
			]]></add>
        </operation>
		<operation error="skip" >
            <search position="replace"  ><![CDATA[if ($product['image']) {]]></search>
            <add><![CDATA[	 		 
				if ($product['image'] && $product['sitemap']) {
			]]></add>
        </operation>
		<operation error="skip" >
            <search position="replace" offset="1" index="1" ><![CDATA[	$output .= '<changefreq>weekly</changefreq>'; ]]></search>
            <add><![CDATA[$output .= '<changefreq>'.( !empty($product['changefreq']) ? $product['changefreq'] : ($setting['changefreq'] ? $setting['changefreq'] : 'weekly')).'</changefreq>';
					$output .= '<priority>'.( !empty($product['priority']) ? $product['priority'] : ($setting['priority'] ? $setting['priority'] : '1.0')).'</priority>';]]></add>
        </operation>
		<operation error="skip" >
            <search position="replace" offset="1" index="4" ><![CDATA[	$output .= '<changefreq>weekly</changefreq>'; ]]></search>
            <add><![CDATA[$output .= '<changefreq>'.( !empty($result['changefreq']) ? $result['changefreq'] : ($setting['changefreq'] ? $setting['changefreq'] : 'weekly')).'</changefreq>';
					$output .= '<priority>'.( !empty($result['priority']) ? $result['priority'] : ($setting['priority'] ? $setting['priority'] : '0.7')).'</priority>';]]></add>
        </operation>
		<operation error="skip" >
            <search position="replace" offset="8"   ><![CDATA[$products = $this->model_catalog_product->getProducts(array('filter_manufacturer_id' => $manufacturer['manufacturer_id']));]]></search>
            <add><![CDATA[]]></add>
        </operation>
		<operation error="skip" >
            <search position="replace" offset="8"   ><![CDATA[	$products = $this->model_catalog_product->getProducts(array('filter_category_id' => $result['category_id'])); ]]></search>
            <add><![CDATA[]]></add>
        </operation>
		 <operation error="skip" >
            <search position="after"  offset = "2" ><![CDATA[$new_path = $current_path . '_' . $result['category_id'];]]></search>
            <add><![CDATA[	
			if ($result['sitemap']) {
			]]></add>
        </operation>
		 <operation error="skip" >
            <search position="before"    ><![CDATA[$output .= $this->getCategories($result['category_id'], $new_path);]]></search>
            <add><![CDATA[	
			}
			]]></add>
        </operation>
    </file>
     <file name="catalog/controller/common/seo_url.php">
        <operation>
            <search position="after" index="2" offset="1"><![CDATA[unset($data[$key]);]]></search>
            <add><![CDATA[else{
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "url_alias WHERE `query` = '" . $this->db->escape($value) . "'");
		if (($query->num_rows && $query->row['keyword']) or $value == 'common/home') {
			$url .= '/' . $query->row['keyword'];
 
			unset($data[$key]);
		}
 
	} ]]></add>
        </operation>	
	</file>
	<file name="system/library/url.php">
        <operation>
            <search position="after"><![CDATA[private $ssl;]]></search>
            <add><![CDATA[	public $currentUrl; ]]></add>
        </operation>
        <operation>
            <search position="after"><![CDATA[$this->ssl = $ssl;]]></search>
            <add><![CDATA[		$this->setCurrentUrl(); ]]></add>
        </operation>
        <operation>
            <search position="before"><![CDATA[public function link($route, $args = '', $secure = false) {]]></search>
            <add><![CDATA[
 /* DV Code START */
	public function setCurrentUrl() {
		$pageURL = 'http';
		if(isset($_SERVER["HTTPS"])){
			if ($_SERVER["HTTPS"] == "on") {$pageURL .= "s";}
		}
		$pageURL .= "://";
		if ($_SERVER["SERVER_PORT"] != "80") {
			$pageURL .= $_SERVER["SERVER_NAME"].":".$_SERVER["SERVER_PORT"].$_SERVER["REQUEST_URI"];
		} else {
			$pageURL .= $_SERVER["SERVER_NAME"].$_SERVER["REQUEST_URI"];
		}
		$this->currentUrl =  str_replace("&", "&amp;", str_replace("&amp;", "&",$pageURL));
		}
 /* DV Code END */
            ]]></add>
        </operation>
	</file>
       	
	<file name="catalog/controller/product/category.php">
		<operation>
            <search position="after"  ><![CDATA[$this->load->model('catalog/category');]]></search>
            <add><![CDATA[ 
		$this->load->model('setting/setting');]]></add>
        </operation>	
        <operation>
            <search position="after" index="1"><![CDATA[$data['continue'] = $this->url->link('common/home');]]></search>
            <add><![CDATA[
/* DV Code START*/
			$this->document->addLink($this->url->link('product/category', 'path=' . $this->request->get['path']), 'canonical');
			if(isset($this->request->get['page']) && $this->request->get['page'] == 1){
				$this->response->redirect($this->url->link('product/category', 'path=' . $this->request->get['path'], 'SSL'), '301');
			}
			if(!isset($page)){ $page = 1; }
			if($page > 1){
				$page_prev = (int)$page - 1; 
			$this->document->addLink($this->url->link('product/category', 'path=' . $this->request->get['path'] . $url  .'&page=' . $page_prev), 'prev');
			}
			$total_page = round($product_total / $limit);
			if($page < $total_page ){
				$page_next = (int)$page + 1; 
			$this->document->addLink($this->url->link('product/category', 'path=' . $this->request->get['path'] . $url  .'&page='  . $page_next ), 'next');
			}
/* 	DV Code END  */
            ]]></add>
        </operation>				
    </file>	
	<file name="catalog/controller/product/search.php">
        <operation>
            <search position="after" index="1"><![CDATA[$pagination->url = $this->url->link('product/search', $url . '&page={page}');]]></search>
            <add><![CDATA[
/*  DV Code START  */
			$this->document->addLink($this->url->link('product/search'), 'canonical');
			if(isset($this->request->get['page']) && $this->request->get['page'] == 1){
				$this->response->redirect($this->url->link('product/search','', 'SSL'), '301');
			}
			if(!isset($page)){ $page = 1; }
			if($page > 1){
				$page_prev = (int)$page - 1; 
			$this->document->addLink($this->url->link('product/search', $url . '&page=' . $page_prev), 'prev');
			}
			$total_page = round($product_total / $limit);
			if($page < $total_page ){
				$page_next = (int)$page + 1; 
			$this->document->addLink($this->url->link('product/search', $url . '&page='  . $page_next ), 'next');
			}
/*   DV Code END  */
            ]]></add>
        </operation>				
    </file>	
	<file name="catalog/controller/product/manufacturer.php">
        <operation>
            <search position="after" index="1"><![CDATA[$pagination->url = $this->url->link('product/manufacturer/info', 'manufacturer_id=' . $this->request->get['manufacturer_id'] .  $url . '&page={page}');]]></search>
            <add><![CDATA[
/* DV Code START  */
			$this->document->addLink($this->url->link('product/manufacturer/info','manufacturer_id=' . $this->request->get['manufacturer_id']), 'canonical');
			if(isset($this->request->get['page']) && $this->request->get['page'] == 1){
				$this->response->redirect($this->url->link('product/manufacturer/info','manufacturer_id=' . $this->request->get['manufacturer_id'], 'SSL'), '301');
			}
			if(!isset($page)){ $page = 1; }
			if($page > 1){
				$page_prev = (int)$page - 1; 
			$this->document->addLink($this->url->link('product/manufacturer/info','manufacturer_id=' . $this->request->get['manufacturer_id'] .  $url . '&page=' . $page_prev), 'prev');
			}
			$total_page = round($product_total / $limit);
			if($page < $total_page ){
				$page_next = (int)$page + 1; 
			$this->document->addLink($this->url->link('product/manufacturer/info','manufacturer_id=' . $this->request->get['manufacturer_id'] .  $url . '&page='  . $page_next ), 'next');
			}
/*  DV Code END */
            ]]></add>
        </operation>				
    </file>
	<file name="catalog/controller/product/special.php">
        <operation>
            <search position="after" index="1"><![CDATA[$pagination->url = $this->url->link('product/special', $url . '&page={page}');]]></search>
            <add><![CDATA[
/*  DV Code START   */
			$this->document->addLink($this->url->link('product/special'), 'canonical');
			if(isset($this->request->get['page']) && $this->request->get['page'] == 1){
				$this->response->redirect($this->url->link('product/special', '', 'SSL'), '301');
			}
			if(!isset($page)){ $page = 1; }
			if($page > 1){
				$page_prev = (int)$page - 1; 
			$this->document->addLink($this->url->link('product/special', $url . '&page=' . $page_prev), 'prev');
			}
			$total_page = round($product_total / $limit);
			if($page < $total_page ){
				$page_next = (int)$page + 1; 
			$this->document->addLink($this->url->link('product/special', $url . '&page='  . $page_next ), 'next');
			}
/*  DV Code END */
            ]]></add>
        </operation>				
    </file>
	<!-- Product url -->
	<file name="catalog/controller/product/category.php">
        <operation>
            <search position="replace"><![CDATA['href'        => $this->url->link('product/product', 'path=' . $this->request->get['path'] . '&product_id=' . $result['product_id'] . $url)]]></search>
            <add><![CDATA[
								'href' => 	($this->model_setting_setting->getSettingValue('d_seo', 'd_seo_url_type',$this->config->get('config_store_id')) ) ? ($this->url->link('product/product', 'product_id=' . $result['product_id'])) : $this->url->link('product/product', 'path=' . $this->request->get['path'] . '&product_id=' . $result['product_id'] . $url)
												]]></add>
        </operation>				
    </file>
	<file name="catalog/controller/product/manufacturer.php">
        <operation>
            <search position="replace"><![CDATA['href'        => $this->url->link('product/product', 'manufacturer_id=' . $result['manufacturer_id'] . '&product_id=' . $result['product_id'] . $url)]]></search>
            <add><![CDATA[
								'href' =>	(($this->model_setting_setting->getSettingValue('d_seo', 'd_seo_url_type',$this->config->get('config_store_id')))  ) ? ($this->url->link('product/product', 'product_id=' . $result['product_id'])) : $this->url->link('product/product', 'manufacturer_id=' . $result['manufacturer_id'] . '&product_id=' . $result['product_id'] . $url)
												]]></add>
        </operation>
		<operation>
            <search position="after"  ><![CDATA[$this->load->language('product/manufacturer');]]></search>
            <add><![CDATA[ 
		$this->load->model('setting/setting');]]></add>
        </operation>			
    </file>
	<file name="catalog/controller/product/search.php">
        <operation>
            <search position="replace"><![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url)]]></search>
            <add><![CDATA[
				'href' =>	(($this->model_setting_setting->getSettingValue('d_seo', 'd_seo_url_type',$this->config->get('config_store_id'))) ) ? ($this->url->link('product/product', 'product_id=' . $result['product_id'])) : $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url)
												]]></add>
        </operation>				
		<operation>
            <search position="after"  ><![CDATA[$this->load->language('product/search');]]></search>
            <add><![CDATA[ 
		$this->load->model('setting/setting');]]></add>
        </operation>	
    </file>
	<file name="catalog/controller/product/special.php">
        <operation>
            <search position="replace"><![CDATA['href'        => $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url)]]></search>
            <add><![CDATA[
												'href' =>	(($this->model_setting_setting->getSettingValue('d_seo', 'd_seo_url_type',$this->config->get('config_store_id')))  ) ? ($this->url->link('product/product', 'product_id=' . $result['product_id']))	: $this->url->link('product/product', 'product_id=' . $result['product_id'] . $url)
												]]></add>
        </operation>
		<operation>
            <search position="after"  ><![CDATA[$this->load->language('product/special');]]></search>
            <add><![CDATA[ 
		$this->load->model('setting/setting');]]></add>
        </operation>			
    </file>
	<file name="catalog/model/catalog/category.php">
        <operation>
            <search position="before"><![CDATA[public function getTotalCategoriesByCategoryId($parent_id = 0) {]]></search>
            <add><![CDATA[
												/*
            * DV Code START
            */	
	public function getPath($category_id) {
	if ($this->customer->isLogged()) {
			$customer_group_id = $this->customer->getGroupId();
		} else {
			$customer_group_id = $this->config->get('config_customer_group_id');
		}
		
		$cache = md5($category_id);
		
		$product_data = $this->cache->get('getPath.' . $category_id . $cache . '.' . $customer_group_id);
		
		if (!$product_data) {
		$query = $this->db->query("SELECT c.category_id, name, parent_id FROM " . DB_PREFIX . "category c LEFT JOIN " . DB_PREFIX . "category_description cd ON (c.category_id = cd.category_id) WHERE c.category_id = '" . (int)$category_id . "' AND cd.language_id = '" . (int)$this->config->get('config_language_id') . "' ORDER BY c.sort_order, cd.name ASC");
		
		if ($query->row['parent_id']) {
			$product_data = $this->getPath($query->row['parent_id'], $this->config->get('config_language_id')) .'_'. $query->row['category_id'];
		} else {
			$product_data = $query->row['category_id'];
		}
		$this->cache->set('getPath.' . $cache . '.' . $customer_group_id, $product_data);
		}
		return $product_data;
	}
			/*
            * DV Code END
            */
            ]]></add>
        </operation>				
    </file>
	<file name="catalog/controller/product/product.php">
        <operation>
            <search position="after"><![CDATA[$this->load->model('catalog/category');]]></search>
            <add><![CDATA[
/*  DV Code START  */	
            if (isset($this->request->get['product_id'])) {
			$product_id = (int)$this->request->get['product_id'];
		} else {
			$product_id = 0;
		}
		$this->load->model('catalog/product');
		$categories = $this->model_catalog_product->getCategories($product_id);
		$path_id = end($categories);
		$path = $this->model_catalog_category->getPath($path_id['category_id']);
		$this->request->get['path'] = $path;

/*  DV Code END */
            ]]></add>
        </operation>
         <operation>
            <search position="before"><![CDATA[$this->document->setTitle($product_info['meta_title']);]]></search>
            <add><![CDATA[
/*  DV Code START  */	
                $this->load->model('setting/setting');
                if (isset($_SERVER['HTTPS']) && (($_SERVER['HTTPS'] == 'on') || ($_SERVER['HTTPS'] == '1'))) {
                    if($this->model_setting_setting->getSettingValue('d_seo', 'd_seo_url_type',$this->config->get('config_store_id'))) {
			if($this->url->link('product/product', 'product_id=' . $this->request->get['product_id'], 'SSL') != $this->url->currentUrl){
                                $this->response->redirect($this->url->link('product/product', 'product_id=' . $this->request->get['product_id'], 'SSL'), '301');
                        }
                    }else{
                        if($this->url->link('product/product', $url . '&product_id=' . $this->request->get['product_id'], 'SSL') != $this->url->currentUrl){
                                $this->response->redirect($this->url->link('product/product', $url . '&product_id=' . $this->request->get['product_id'], 'SSL'), '301');
                        }
                    }
                }else{
                    if($this->model_setting_setting->getSettingValue('d_seo', 'd_seo_url_type',$this->config->get('config_store_id'))) {
			if($this->url->link('product/product', 'product_id=' . $this->request->get['product_id']) != $this->url->currentUrl){
                                $this->response->redirect($this->url->link('product/product', 'product_id=' . $this->request->get['product_id']), '301');
                        }
                    }else{
                        if($this->url->link('product/product', $url . '&product_id=' . $this->request->get['product_id']) != $this->url->currentUrl){
                                $this->response->redirect($this->url->link('product/product', $url . '&product_id=' . $this->request->get['product_id']), '301');
                        }
                    }
                }
/*  DV Code END */
            ]]></add>
        </operation>			
    </file>	
	<file name="catalog/controller/product/category.php">
        <operation>
            <search position="before"><![CDATA[$category_info = $this->model_catalog_category->getCategory($category_id);]]></search>
            <add><![CDATA[
/* DV Code START  */
			
		$path = $this->model_catalog_category->getPath($category_id);
		if($path){
			$this->request->get['path'] = $path;
		}
		
		$url = '';
		if(isset($this->request->get['sort'])){
			$url = $url.'&sort='.$this->request->get['sort'];
		}
		if(isset($this->request->get['limit'])){
			$url = $url.'&limit='.$this->request->get['limit'];
		}
		if(isset($this->request->get['order'])){
			$url = $url.'&order='.$this->request->get['order'];
		}
		if(isset($this->request->get['page'])){
			$url = $url.'&page='.$this->request->get['page'];
		}
		if(isset($this->request->get['filter'])){
			$url = $url.'&filter='.$this->request->get['filter'];
		} 
                if (isset($_SERVER['HTTPS']) && (($_SERVER['HTTPS'] == 'on') || ($_SERVER['HTTPS'] == '1'))) {
                    if($this->url->link('product/category', 'path=' . $this->request->get['path'].$url, 'SSL') != $this->url->currentUrl){
                            $this->response->redirect($this->url->link('product/category', 'path=' . $this->request->get['path'].$url, 'SSL'), '301');
                    }
                }else{
                    if($this->url->link('product/category', 'path=' . $this->request->get['path'].$url) != $this->url->currentUrl){
                            $this->response->redirect($this->url->link('product/category', 'path=' . $this->request->get['path'].$url), '301');
                    }
                }
/*  DV Code END */
            ]]></add>
        </operation>				
    </file>	
    <file name="catalog/controller/common/footer.php">
		<operation error="skip">
			<search position="before"><![CDATA[$this->load->model('catalog/information');]]></search>
			<add><![CDATA[$data['text_itemscope'] = $this->language->get('text_itemscope');
        $data['text_itemscope_link'] = $this->language->get('text_itemscope_link');
        $data['text_itemscope_adress'] = $this->language->get('text_itemscope_adress');]]></add>
		</operation>
	</file>

</modification>
 